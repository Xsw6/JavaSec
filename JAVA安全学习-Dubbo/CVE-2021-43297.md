# CVE-2021-43297

学习：https://www.cnblogs.com/bitterz/p/15828415.html

在看了这位师傅如何在Hessian中触发toString....只能说又学习到了。
不同于之前的重写类和y4er师傅的方法类似，但是其实目的都是调用readBoolean、readString、readInt等方法。在这里这位师傅发现了，hessian会根据属性进行相应的readBoolean进行调用。

师傅的思路：
![image-20230104200032460](https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202301042000576.png)

当然这里我们同时也可以进行重写类完成整个poc。
在高版本2.7.9<dubbo<2.7.13中，会有如下的限制
![image-20230104201536330](https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202301042015562.png)

然后我们通过header[2]、header[3]（`他们都是由我们手动可控制的`）进行绕过。发现在这里会触发readUTF，从而进一步触发readString，从而触发toStting。

太有意思了.....

## ReadOnlyBinding.toString

ContextUtil.ReadOnlyBinding通过toString的调用调用getObject方法也就是会调用到ContextUtil重写的getObject方法，进行NamingManager下载恶意类class并且实例化。

## 修复

文章中也说了，先是增加了黑名单，后续直接将expect中的obj给修复了....

## 总结

就是想近各种办法去触发expect....